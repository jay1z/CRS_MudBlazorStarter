<MudStack Spacing="1">
    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
        <MudText Typo="Typo.caption" Color="Color.Secondary">@Label</MudText>
        @if (!IsOverriding)
        {
            <MudChip T="string" Size="Size.Small" Color="Color.Default" Variant="Variant.Outlined">Default</MudChip>
        }
    </MudStack>
    
    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
        <MudSwitch T="bool" Value="IsOverriding" ValueChanged="OnToggleOverride"
                   Color="Color.Primary" Size="Size.Small"
                   Label="@(IsOverriding ? "Override" : "Use Default")"
                   LabelPosition="LabelPosition.Start" />
    </MudStack>
    
    <MudNumericField T="decimal" Value="@DisplayValue" ValueChanged="OnDisplayValueChanged"
                     Disabled="@(!IsOverriding)"
                     Variant="Variant.Outlined"
                     Min="0" Max="100" Step="0.1m"
                     Adornment="Adornment.End" AdornmentText="%"
                     HelperText="@HelperText" />
</MudStack>

@code {
    [Parameter, EditorRequired]
    public string Label { get; set; } = "";
    
    [Parameter]
    public decimal? OverrideValue { get; set; }
    
    [Parameter]
    public decimal DefaultValue { get; set; }
    
    [Parameter]
    public EventCallback<decimal?> OnOverrideValueChanged { get; set; }
    
    [Parameter]
    public string? HelperText { get; set; }
    
    private bool IsOverriding => OverrideValue.HasValue;
    
    // Display as percentage (multiply by 100)
    private decimal DisplayValue => (OverrideValue ?? DefaultValue) * 100;
    
    private async Task OnToggleOverride(bool isOverriding)
    {
        if (isOverriding)
        {
            await OnOverrideValueChanged.InvokeAsync(DefaultValue);
        }
        else
        {
            await OnOverrideValueChanged.InvokeAsync(null);
        }
    }
    
    private async Task OnDisplayValueChanged(decimal displayValue)
    {
        // Convert back to decimal rate (divide by 100)
        await OnOverrideValueChanged.InvokeAsync(displayValue / 100);
    }
}
