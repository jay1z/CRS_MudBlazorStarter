@page "/app"
@using MudBlazor

<MudLayout>

    <!-- LEFT NAV (MINI / COLLAPSED) -->
    <MudDrawer @bind-Open="_drawerOpen"
               Variant="DrawerVariant.Mini"
               Elevation="4"
               Anchor="Anchor.Left"
               ClipMode="DrawerClipMode.Always">
        <MudNavMenu Dense="true">
            <MudNavLink Icon="@Icons.Material.Filled.Dashboard" Href="/app" Match="NavLinkMatch.All" />
            <MudNavLink Icon="@Icons.Material.Filled.HomeWork" Href="/app/properties" />
            <MudNavLink Icon="@Icons.Material.Filled.Assessment" Href="/app/studies" />
            <MudNavLink Icon="@Icons.Material.Filled.Description" Href="/app/reports" />
            <MudNavLink Icon="@Icons.Material.Filled.People" Href="/app/customers" />
            <MudNavLink Icon="@Icons.Material.Filled.SupportAgent" Href="/app/support" />
        </MudNavMenu>
    </MudDrawer>

    <MudMainContent>

        <!-- TOP APP BAR -->
        <MudAppBar Elevation="4" Color="Color.Primary">
            <MudIconButton Edge="Start"
                           Icon="@Icons.Material.Filled.Menu"
                           Color="Color.Inherit"
                           OnClick="@ToggleDrawer" />
            <MudAvatar Class="me-2" Icon="@Icons.Material.Filled.Cloud" Color="Color.Secondary" />
            <MudText Typo="Typo.h6" Class="me-2">
                ALX Reserve Cloud
            </MudText>
            <MudText Typo="Typo.subtitle2" Class="mud-text-muted">
                @TenantName
            </MudText>

            <MudSpacer />

            <MudChip Color="Color.Secondary"
                     Variant="Variant.Filled"
                     Label="true">
                TenantOwner
            </MudChip>
        </MudAppBar>

        <!-- PAGE CONTENT -->
        <MudContainer MaxWidth="MaxWidth.False" Class="pa-6" Style="max-width:1440px; margin:0 auto;">

            <!-- HERO HEADER -->
            <MudPaper Class="pa-5 mb-4" Elevation="1" Square="false">
                <MudGrid>
                    <MudItem xs="12" sm="8">
                        <MudStack Row="true" AlignItems="center" Spacing="2">
                            <MudAvatar Icon="@Icons.Material.Filled.HomeWork"
                                       Size="Size.Large"
                                       Color="Color.Primary" />
                            <MudStack>
                                <MudText Typo="Typo.h4">@TenantName</MudText>
                                <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">
                                    You are logged in as:
                                    <MudChip Color="Color.Info"
                                             Variant="Variant.Filled"
                                             Label="true"
                                             Class="ms-1">
                                        TenantOwner
                                    </MudChip>
                                </MudText>
                            </MudStack>
                        </MudStack>
                    </MudItem>
                    <MudItem xs="12" sm="4" Class="d-flex justify-end align-center">
                        <MudButton Color="Color.Primary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Add">
                            Create first property
                        </MudButton>
                    </MudItem>
                </MudGrid>
            </MudPaper>

            <!-- GLOBAL NOTIFICATIONS BANNER -->
            <MudAlert Severity="Severity.Info"
                      Variant="Variant.Filled"
                      Elevation="1"
                      Dense="false"
                      Class="mb-4">
                <MudIcon Icon="@Icons.Material.Filled.Info" Class="me-2" />
                Global notification banner. Configure deadlines, upcoming renewals, and platform notices here.
            </MudAlert>

            <!-- KPI CARDS -->
            <MudGrid Class="mb-4" GutterSize="3">
                <MudItem xs="12" sm="6" md="3">
                    <MudPaper Class="pa-3 d-flex flex-column" Elevation="1">
                        <MudStack Row="true" AlignItems="center" Justify="space-between">
                            <MudText Typo="Typo.subtitle2">Properties</MudText>
                            <MudIcon Icon="@Icons.Material.Filled.HomeWork" />
                        </MudStack>
                        <MudText Typo="Typo.h4" Class="mt-2">@KpiProperties</MudText>
                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Primary"
                                   Class="mt-2"
                                   FullWidth="true">
                            Create first property
                        </MudButton>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6" md="3">
                    <MudPaper Class="pa-3 d-flex flex-column" Elevation="1">
                        <MudStack Row="true" AlignItems="center" Justify="space-between">
                            <MudText Typo="Typo.subtitle2">Active Studies</MudText>
                            <MudIcon Icon="@Icons.Material.Filled.Assessment" />
                        </MudStack>
                        <MudText Typo="Typo.h4" Class="mt-2">@KpiActiveStudies</MudText>
                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Primary"
                                   Class="mt-2"
                                   FullWidth="true">
                            Start first study
                        </MudButton>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6" md="3">
                    <MudPaper Class="pa-3 d-flex flex-column" Elevation="1">
                        <MudStack Row="true" AlignItems="center" Justify="space-between">
                            <MudText Typo="Typo.subtitle2">Reports</MudText>
                            <MudIcon Icon="@Icons.Material.Filled.Description" />
                        </MudStack>
                        <MudText Typo="Typo.h4" Class="mt-2">@KpiReports</MudText>
                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Primary"
                                   Class="mt-2"
                                   FullWidth="true">
                            Generate first report
                        </MudButton>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6" md="3">
                    <MudPaper Class="pa-3 d-flex flex-column" Elevation="1">
                        <MudStack Row="true" AlignItems="center" Justify="space-between">
                            <MudText Typo="Typo.subtitle2">Customer Accounts</MudText>
                            <MudIcon Icon="@Icons.Material.Filled.People" />
                        </MudStack>
                        <MudText Typo="Typo.h4" Class="mt-2">@KpiCustomerAccounts</MudText>
                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Primary"
                                   Class="mt-2"
                                   FullWidth="true">
                            Add first customer
                        </MudButton>
                    </MudPaper>
                </MudItem>
            </MudGrid>

            <!-- PIPELINE BOARD + PROPERTIES / CUSTOMERS / LINKS -->
            <MudGrid Class="mb-4" GutterSize="3">
                <!-- PIPELINE BOARD -->
                <MudItem xs="12" md="8">
                    <MudPaper Class="pa-4" Elevation="1">
                        <MudText Typo="Typo.h6" Class="mb-3">Pipeline</MudText>

                        <MudGrid GutterSize="2">
                            <MudItem xs="12" sm="4">
                                <MudPaper Class="pa-3" Elevation="0">
                                    <MudText Typo="Typo.subtitle2">Screening</MudText>
                                    <MudText Typo="Typo.h5" Class="mt-1">@PipelineScreening</MudText>
                                    <MudButton Variant="Variant.Text"
                                               Color="Color.Primary"
                                               Class="mt-2"
                                               FullWidth="true">
                                        Create first screening
                                    </MudButton>
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="12" sm="4">
                                <MudPaper Class="pa-3" Elevation="0">
                                    <MudText Typo="Typo.subtitle2">Enrollment</MudText>
                                    <MudText Typo="Typo.h5" Class="mt-1">@PipelineEnrollment</MudText>
                                    <MudButton Variant="Variant.Text"
                                               Color="Color.Primary"
                                               Class="mt-2"
                                               FullWidth="true">
                                        Create first enrollment
                                    </MudButton>
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="12" sm="4">
                                <MudPaper Class="pa-3" Elevation="0">
                                    <MudText Typo="Typo.subtitle2">Complete</MudText>
                                    <MudText Typo="Typo.h5" Class="mt-1">@PipelineComplete</MudText>
                                    <MudButton Variant="Variant.Text"
                                               Color="Color.Primary"
                                               Class="mt-2"
                                               FullWidth="true">
                                        Create first completed study
                                    </MudButton>
                                </MudPaper>
                            </MudItem>
                        </MudGrid>
                    </MudPaper>
                </MudItem>

                <!-- CUSTOMER ACCOUNTS + HELPFUL LINKS -->
                <MudItem xs="12" md="4">
                    <MudStack Spacing="3">
                        <MudPaper Class="pa-4" Elevation="1">
                            <MudText Typo="Typo.h6">Customer Accounts</MudText>
                            <MudText Typo="Typo.body2" Class="mt-2 mud-text-secondary">
                                You do not have any customer accounts yet.
                            </MudText>
                            <MudButton Color="Color.Primary"
                                       Variant="Variant.Filled"
                                       Class="mt-3"
                                       FullWidth="true"
                                       StartIcon="@Icons.Material.Filled.PersonAdd">
                                Add customer account
                            </MudButton>
                        </MudPaper>

                        <MudPaper Class="pa-4" Elevation="1">
                            <MudText Typo="Typo.h6">Helpful Links</MudText>
                            <MudList Dense="true" Class="mt-2">
                                <MudListItem Href="https://alxreservecloud.com/docs" Target="_blank">
                                    Onboarding guide
                                </MudListItem>
                                <MudListItem Href="https://alxreservecloud.com/help/faq" Target="_blank">
                                    Frequently asked questions
                                </MudListItem>
                                <MudListItem Href="https://alxreservecloud.com/support" Target="_blank">
                                    Contact support
                                </MudListItem>
                                <MudListItem Href="https://alxreservecloud.com/status" Target="_blank">
                                    System status
                                </MudListItem>
                            </MudList>
                        </MudPaper>
                    </MudStack>
                </MudItem>
            </MudGrid>

            <!-- PROPERTIES TABLE + ACTIVITY + SUPPORT TICKETS -->
            <MudGrid GutterSize="3">
                <!-- PROPERTIES TABLE -->
                <MudItem xs="12" md="7">
                    <MudPaper Class="pa-4" Elevation="1">
                        <MudStack Row="true" Justify="space-between" AlignItems="center" Class="mb-2">
                            <MudText Typo="Typo.h6">Properties</MudText>
                            <MudButton Variant="Variant.Text"
                                       Color="Color.Primary"
                                       StartIcon="@Icons.Material.Filled.Add">
                                Create property
                            </MudButton>
                        </MudStack>

                        @if (!Properties.Any())
                        {
                            <MudText Typo="Typo.body2" Class="mud-text-secondary mb-2">
                                You have not added any properties yet.
                            </MudText>
                            <MudButton Color="Color.Primary"
                                       Variant="Variant.Filled"
                                       StartIcon="@Icons.Material.Filled.AddBusiness">
                                Create first property
                            </MudButton>
                        }
                        else
                        {
                            <MudTable Dense="true" Hover="true" Items="Properties">
                                <HeaderContent>
                                    <MudTh>Name</MudTh>
                                    <MudTh>Location</MudTh>
                                    <MudTh>Status</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd DataLabel="Name">@context.Name</MudTd>
                                    <MudTd DataLabel="Location">@context.Location</MudTd>
                                    <MudTd DataLabel="Status">@context.Status</MudTd>
                                </RowTemplate>
                            </MudTable>
                        }
                    </MudPaper>
                </MudItem>

                <!-- ACTIVITY + SUPPORT TICKETS -->
                <MudItem xs="12" md="5">
                    <MudStack Spacing="3">
                        <MudPaper Class="pa-4" Elevation="1">
                            <MudText Typo="Typo.h6">Activity</MudText>

                            @if (!Activity.Any())
                            {
                                <MudText Typo="Typo.body2" Class="mt-2 mud-text-secondary">
                                    No activity yet. As you create properties, studies, and reports, they will appear here.
                                </MudText>
                            }
                            else
                            {
                                <MudList Dense="true" Class="mt-2">
                                    @foreach (var item in Activity)
                                    {
                                        <MudListItem>
                                            <MudText Typo="Typo.body2">@item.Description</MudText>
                                            <MudText Typo="Typo.caption" Class="mud-text-secondary">
                                                @item.Timestamp.ToString("g")
                                            </MudText>
                                        </MudListItem>
                                    }
                                </MudList>
                            }
                        </MudPaper>

                        <MudPaper Class="pa-4" Elevation="1">
                            <MudStack Row="true" Justify="space-between" AlignItems="center">
                                <MudText Typo="Typo.h6">Support Tickets</MudText>
                                <MudButton Variant="Variant.Outlined"
                                           Color="Color.Primary"
                                           Size="Size.Small"
                                           StartIcon="@Icons.Material.Filled.Add">
                                    New ticket
                                </MudButton>
                            </MudStack>

                            @if (!Tickets.Any())
                            {
                                <MudText Typo="Typo.body2" Class="mt-2 mud-text-secondary">
                                    You do not have any open support tickets.
                                </MudText>
                            }
                            else
                            {
                                <MudList Dense="true" Class="mt-2">
                                    @foreach (var ticket in Tickets)
                                    {
                                        <MudListItem>
                                            <MudStack>
                                                <MudText Typo="Typo.body2">
                                                    #@ticket.Number - @ticket.Subject
                                                </MudText>
                                                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                                                    @ticket.Status â€¢ @ticket.Created.ToString("g")
                                                </MudText>
                                            </MudStack>
                                        </MudListItem>
                                    }
                                </MudList>
                            }
                        </MudPaper>
                    </MudStack>
                </MudItem>
            </MudGrid>

        </MudContainer>
    </MudMainContent>

</MudLayout>

@code {
    private bool _drawerOpen = false;

    private string TenantName => "Sample HOA Management Co.";

    private int KpiProperties => 0;
    private int KpiActiveStudies => 0;
    private int KpiReports => 0;
    private int KpiCustomerAccounts => 0;

    private int PipelineScreening => 0;
    private int PipelineEnrollment => 0;
    private int PipelineComplete => 0;

    private List<PropertyRow> Properties { get; set; } = new();

    private List<ActivityItem> Activity { get; set; } = new();
    private List<TicketItem> Tickets { get; set; } = new();

    private void ToggleDrawer()
        => _drawerOpen = !_drawerOpen;

    public class PropertyRow
    {
        public string Name { get; set; } = default!;
        public string Location { get; set; } = default!;
        public string Status { get; set; } = default!;
    }

    public class ActivityItem
    {
        public string Description { get; set; } = default!;
        public DateTime Timestamp { get; set; }
    }

    public class TicketItem
    {
        public string Number { get; set; } = default!;
        public string Subject { get; set; } = default!;
        public string Status { get; set; } = default!;
        public DateTime Created { get; set; }
    }
}
