@using Horizon.Data
@using Horizon.Services
@using Horizon.Services.Tenant
@using Microsoft.AspNetCore.Identity
@inject UserStateService UserState
@inject NavigationManager NavigationManager
@inject ITenantContext TenantContext

<MudNavMenu>
    <MudDivider Class="my-2" />
    <MudNavMenu>
        <MudText Typo="Typo.h6" Class="px-4">Platform Administration</MudText>
        <MudText Typo="Typo.body2" Class="px-4 mud-text-secondary">Global tools and management</MudText>
        <MudDivider Class="my-2" />
    </MudNavMenu>

    <AuthorizeView Policy="RequirePlatformAdmin" Context="platAuth">
        <Authorized>
            <MudNavGroup Title="Platform Admin" Expanded="true">
                <MudNavLink Href="/Admin/Tenants" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Apartment">Tenants</MudNavLink>
                <MudNavLink Href="/Admin/Users" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.PeopleAlt">Users & Roles</MudNavLink>
                <MudNavLink Href="/Admin/SuperAdmins" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.VerifiedUser">SuperAdmins</MudNavLink>
                <MudNavLink Href="/Admin/Billing" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.CreditCard">Billing</MudNavLink>
            </MudNavGroup>

            <MudDivider />
            <MudNavGroup Title="Marketing" Expanded="true">
                <MudNavLink Href="/admin/newsletter" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Campaign">Newsletter</MudNavLink>
            </MudNavGroup>

            <MudDivider />
            <MudNavGroup Title="Platform Tools" Expanded="false">
                <MudNavLink Href="/reserve-calculator/demo" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Calculate">Calculator</MudNavLink>
                <MudNavLink Href="/dbmanager" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Storage">Database</MudNavLink>
                <MudNavLink Href="/Admin/Audit" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.History">Audit Logs</MudNavLink>
            </MudNavGroup>

            <MudDivider />
            <MudNavGroup Title="Tenant Actions" Expanded="false">
                <MudNavLink Href="/Admin/Impersonate" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.PersonSearch">Impersonate Tenant</MudNavLink>
                @if (TenantContext?.TenantId != null)
                {
                    <MudNavLink Href="/Admin/StopImpersonation" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.HighlightOff" IconColor="Color.Error">Stop Impersonation</MudNavLink>
                }
            </MudNavGroup>

        </Authorized>
    </AuthorizeView>

    <!-- Show platform info for transparency -->
    <MudDivider Class="my-2" />
    <MudText Typo="Typo.caption" Class="px-4">Platform mode</MudText>
</MudNavMenu>